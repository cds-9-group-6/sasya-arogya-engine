sequenceDiagram
    participant U as ðŸ‘¤ User
    participant A as ðŸŒ API Gateway
    participant F as ðŸ”„ FSM Agent
    participant I as ðŸ§  Intent Analyzer
    participant C as ðŸ” CNN Classifier
    participant L as ðŸ¤– LLM Server
    participant R as ðŸ“š RAG System
    participant V as ðŸª Vendor Service
    participant O as ðŸ“Š Observability
    
    U->>A: POST /chat-stream
    A->>F: Process Message
    F->>I: Analyze Intent
    I->>L: Classify Intent
    L-->>I: Intent Result
    I-->>F: Intent + Context
    
    F->>C: Classify Disease (if image)
    C->>L: Validate Classification
    L-->>C: Validation Result
    C-->>F: Disease + Confidence
    
    F->>R: Generate Prescription
    R->>L: Generate Treatment
    L-->>R: Treatment Plan
    R-->>F: Prescription Data
    
    F->>V: Find Vendors
    V-->>F: Vendor Options
    F-->>A: Stream Response
    A-->>U: Real-time Updates
    
    Note over O: All operations monitored
    F->>O: Metrics & Traces
    A->>O: Request Metrics
    C->>O: ML Metrics
    L->>O: LLM Metrics